<script>
const sheetDataUrl = "https://script.google.com/macros/s/AKfycbwM8rZO1cOlMe6ivAaTEDkFjY2xt3fR33fwfqbL0PbWCGfyG_Kpm-7Phfq34eob9NcZ/exec";

const map = L.map('map').setView([-2.5, 117.5], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap contributors'
}).addTo(map);

fetch(sheetDataUrl)
  .then(res => res.json())
  .then(data => {
    data.forEach(row => {
      const lat = parseFloat(row.Latitude);
      const lon = parseFloat(row.Longitude);
      const level = row.Confidence_Level?.toLowerCase();

      if (!isNaN(lat) && !isNaN(lon)) {
        const iconHtml = level === 'high' ? 'ðŸ”¥' : 'ðŸŸ¡';

        const customIcon = L.divIcon({
          html: `<div style="font-size: 16px; opacity: 0.5;">${iconHtml}</div>`,
          iconSize: [16, 16],
          className: '' // remove default icon class
        });

        const marker = L.marker([lat, lon], { icon: customIcon }).addTo(map);

        marker.bindPopup(`
          <b>${row["Tanggal & Jam"]}</b><br>
          Provinsi: ${row.Provinsi}<br>
          Kab/Kota: ${row["Kab/Kota"]}<br>
          Kec: ${row.Kecamatan}<br>
          Desa: ${row.Desa}<br>
          Sumber: ${row.Sumber}<br>
          Level: ${row.Confidence_Level}
        `);
      }
    });
  });
</script>
